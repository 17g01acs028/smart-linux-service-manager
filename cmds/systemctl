#!/bin/bash

# usage: ./systemctl [command] [service]
CMD=$1
SERVICE=$2
STATE_DIR="/tmp/mock_systemctl"
mkdir -p $STATE_DIR
STATE_FILE="$STATE_DIR/$SERVICE.state"

case $CMD in
    start)
        echo "ACTIVE" > $STATE_FILE
        echo "Started $SERVICE"
        ;;
    stop)
        echo "INACTIVE" > $STATE_FILE
        echo "Stopped $SERVICE"
        ;;
    restart)
        echo "ACTIVE" > $STATE_FILE
        echo "Restarted $SERVICE"
        ;;
    is-active)
        if [ -f $STATE_FILE ] && grep -q "^ACTIVE$" $STATE_FILE; then
            exit 0
        else
            exit 1 # Inactive
        fi
        ;;
    is-failed)
        if [ -f $STATE_FILE ] && grep -q "^FAILED$" $STATE_FILE; then
            exit 0 # YES, it is failed
        else
            exit 1 # NO, it is not failed (could be active or inative)
        fi
        ;;
    fail)
        # Helper to simulate crash
        echo "FAILED" > $STATE_FILE
        echo "Simulated crash for $SERVICE"
        ;;
    *)
        echo "Unknown command: $CMD"
        exit 1
        ;;
esac
